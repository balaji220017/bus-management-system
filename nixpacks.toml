# Nixpacks config for Railway - used when deploying backend service
# Use this for the backend service only (set root to server or use separate repo)

[phases.setup]
nixPkgs = ["nodejs_20"]

[phases.install]
cmds = ["npm ci"]

[phases.build]
cmds = ["node scripts/use-postgres-schema.js", "npx prisma generate"]

[start]
cmd = "npx prisma db push --accept-data-loss 2>/dev/null || true && npx tsx server/index.ts"
